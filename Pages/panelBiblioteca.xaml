<Page x:Class="Project_Lightning.Pages.panelBiblioteca"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:Project_Lightning.Pages"
      xmlns:classes="clr-namespace:Project_Lightning.Classes"
      mc:Ignorable="d" 
      d:DesignHeight="840" d:DesignWidth="1420"
      Title="panelBiblioteca">

    <Page.Resources>
        <!--ESTILO DEL SCROLLVIEW-->
        <Style TargetType="ScrollBar">
            <Setter Property="Width" Value="3"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollBar">
                        <Grid Background="Transparent">
                            <Track Name="PART_Track" IsDirectionReversed="True">
                                <Track.DecreaseRepeatButton>
                                    <RepeatButton Command="ScrollBar.LineUpCommand" Visibility="Collapsed"/>
                                </Track.DecreaseRepeatButton>
                                <Track.Thumb>
                                    <Thumb>
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="Thumb">
                                                <Border Background="#555" CornerRadius="3"/>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </Track.Thumb>
                                <Track.IncreaseRepeatButton>
                                    <RepeatButton Command="ScrollBar.LineDownCommand" Visibility="Collapsed"/>
                                </Track.IncreaseRepeatButton>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!--Sombra-->
        <DropShadowEffect x:Key="DropShadowEffect"
              Color="Black"
              BlurRadius="8"
              ShadowDepth="2"
              Opacity="0.5"/>
        
        <!--EFECTO DE LAS IMAGENES-->
        <Style TargetType="Image" x:Key="GameImageStyle">
            <!-- Centrar el punto de escalado -->
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                </Setter.Value>
            </Setter>

            <Style.Triggers>
                <!-- HOVER -->
                <Trigger Property="IsMouseOver" Value="True">
                    <Trigger.EnterActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <!-- Escalado al pasar el ratón -->
                                <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(ScaleTransform.ScaleX)" To="1.08" Duration="0:0:0.2"/>
                                <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(ScaleTransform.ScaleY)" To="1.08" Duration="0:0:0.2"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.EnterActions>
                    <Trigger.ExitActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <!-- Volver a tamaño normal -->
                                <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(ScaleTransform.ScaleX)" To="1" Duration="0:0:0.2"/>
                                <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(ScaleTransform.ScaleY)" To="1" Duration="0:0:0.2"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.ExitActions>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!--BOTON MODERNO GENERICO-->
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Background" Value="#3A3A3A"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="6"/>
            <Setter Property="Effect" Value="{StaticResource DropShadowEffect}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="PART_Border"
                Background="{TemplateBinding Background}" 
                CornerRadius="6">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="PART_Border" Property="Background" Value="#555"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="PART_Border" Property="Background" Value="#0078D7"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!--BOTON DE ELIMINAR JUEGO-->
        <Style x:Key="DeleteButton" TargetType="Button" BasedOn="{StaticResource ModernButton}">
            <Setter Property="Background" Value="#DE3535"/>
            <!-- Rojo principal -->
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="16,5"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="PART_Border"
                        Background="{TemplateBinding Background}" 
                        CornerRadius="5"
                        BorderBrush="#A94442"
                        BorderThickness="1">
                            <ContentPresenter 
                        Margin="{TemplateBinding Padding}"
                        HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                        VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="PART_Border" Property="Background" Value="#E06B6B"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="PART_Border" Property="Background" Value="#A94442"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="PART_Border" Property="Background" Value="#C0C0C0"/>
                                <Setter Property="Foreground" Value="#808080"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!--PARA LOS TOOLTIP-->
        <Style TargetType="ToolTip">
            <Setter Property="Background" Value="#222222"/>
            <!-- FONDO OSCURO -->
            <Setter Property="Foreground" Value="White"/>
            <!-- TEXTO BLANCO -->
            <Setter Property="BorderBrush" Value="#444444"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="6"/>
            <Setter Property="FontSize" Value="13"/>
        </Style>

        <classes:ScoreToColorConverter x:Key="ScoreToColorConverter"/>

        <classes:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>

    </Page.Resources>



    <Grid Background="Transparent" Name="RootGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!--PARTE PARA EL RELOJ Y PARA AGREGAR NUEVOS JUEGOS-->
        <Grid Grid.Row="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="auto"/>
            </Grid.RowDefinitions>
            
            <!--PARTE DE ARRIBA (ARRASTRAR JUEGOS, RELOJ, BUSCADOR POR APPID)-->
            <Grid Grid.Row="0">
                
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="3*"/>
                    <ColumnDefinition Width="4*"/>
                    <ColumnDefinition Width="3*"/>
                </Grid.ColumnDefinitions>

                
                <!--PARTE PARA ARRASTRAR LOS ARCHIVOS A MI APP E IMPORTAR LOS LUA-->
                <Border Grid.Column="0" Grid.Row="0" Name="componenteArrastrar" Margin="50" CornerRadius="8" BorderThickness="2" BorderBrush="Gray" Background="#2A2A2A" 
                        AllowDrop="True" DragEnter="DropArea_DragEnter" DragLeave="DropArea_DragLeave" Drop="DropArea_Drop">

                    <TextBlock Text="Drag and drop your .lua, .manifest or .zip files here" Foreground="White" FontSize="16" HorizontalAlignment="Center" 
                               VerticalAlignment="Center" TextWrapping="Wrap" TextAlignment="Center" Padding="5"/>
                </Border>



                <!--PARTE PARA EL RELOJ-->
                <TextBlock x:Name="RelojMinimalista" Grid.Column="1" FontSize="140" Foreground="White" Opacity="0" TextAlignment="Center" Background="Transparent"
                           FontFamily="pack://application:,,,/res/fonts/#SF Pro Display Bold"  HorizontalAlignment="Center" VerticalAlignment="Center"/>
                
                
                
                <!--PARTE PARA EL BUSCADOR DE APPIDS DE JUEGOS Y AÑADIRLOS A LA BIBLIOTECA-->
                <Grid Grid.Column="2">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!--PARTE PARA EL BOTON DE REINICIAR STEAM-->
                    <Button x:Name="btnBuscarSteam" Grid.Column="1" Width="150" Height="40" Background="#3A3A3A" BorderThickness="0"  Cursor="Hand" ToolTip="Select folder"
                            HorizontalAlignment="Center" VerticalAlignment="Bottom" Style="{StaticResource ModernButton}" Click="ReiniciarSteam" Margin="0,0,0,5">

                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" >
                            <!-- ICONO -->
                            <Image Source="/res/icons/steam.png" Width="25" Height="25" Margin="0,0,10,0"/>
                            <!-- TEXTO -->
                            <TextBlock Text="Restart Steam" Foreground="White" FontSize="16" VerticalAlignment="Center"/>
                        </StackPanel>

                    </Button>

                    <!--PARTE PARA EL BUSCADOR-->
                    <Border Grid.Row="1" Name="gridAñadirJuego" CornerRadius="8" Background="#2A2A2A" Padding="8" VerticalAlignment="Top" Effect="{DynamicResource DropShadowEffect}" 
                            Width="255" Height="55" Margin="0,5,0,0">
                        
                        <StackPanel Grid.Row="1" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center" >
                            <TextBox x:Name="AppIdTextBox" Width="120" Height="30" Padding="10,0" Background="#1E1E1E" Foreground="White" 
                                      FontSize="14" VerticalContentAlignment="Center" HorizontalContentAlignment="Left" Margin="0,0,5,0"/>
                            <Button x:Name="btnAgregarAppId" Content="Add Game" Width="110" Height="35" Background="#3A3A3A" Foreground="White" FontSize="14" 
                                    Cursor="Hand" BorderThickness="0" Style="{StaticResource ModernButton}" Click="AgregarAppId_Click"/>
                        </StackPanel>
                        
                    </Border>
                    


                </Grid>
                
                




            </Grid>

            <!--PARTE DE ABAJO, (IMAGEN DEL JUEGO, NOMBRE DEL JUEGO, BUSCAODR DE LA BIBLIOTECA)-->
            <Border Grid.Row="1" Name="juegoIndependiente" CornerRadius="8" Background="#2A2A2A" Padding="8" Effect="{DynamicResource DropShadowEffect}" Margin="10,0,10,0" Opacity="0">
                <Grid >

                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="auto"/>
                        <ColumnDefinition Width="auto"/>

                    </Grid.ColumnDefinitions>

                    <!--IMAGEN HEADER DEL JUEGO-->
                    <Image x:Name="HeaderImage" Grid.Column="0" HorizontalAlignment="Left" VerticalAlignment="Bottom" Width="184" Height="86"
                           Stretch="UniformToFill" Margin="0"/>

                    <!--NOMBRE DEL JUEGO-->
                    <TextBlock  Name="nombreJuego" Grid.Column="1" Foreground="White" FontSize="26" Margin="10,0,0,0" HorizontalAlignment="Left" TextAlignment="Center"
                            VerticalAlignment="Center" TextWrapping="Wrap"/>


                    <Grid Grid.Column="2" Name="metacriticGrid" HorizontalAlignment="Left" Margin="0,0,40,0">
                        <Grid.ColumnDefinitions>
                            <!--PARA METACRITIC-->
                            <ColumnDefinition Width="AUTO"/>
                            <!--PARA EL PEGI-->
                            <ColumnDefinition Width="Auto"/>
                            <!--PARA LAS PLATAFORMAS SOPORTADAS-->
                            <ColumnDefinition Width="130"/>
                        </Grid.ColumnDefinitions>

                        <!-- CÍRCULO DE METACRITIC -->
                        <Grid Width="60" Height="60" ToolTip="Metacritic Score" Margin="10,0,10,0">
                            <Ellipse Stroke="Gray" StrokeThickness="8" Fill="Transparent"/>
                            <Path x:Name="ScoreArc" StrokeThickness="8" Fill="Transparent" Stroke="#02B31B"/>
                            <TextBlock x:Name="metacriticScore" Text="0" FontSize="20" FontWeight="Bold"
                                       HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White"/>
                        </Grid>

                        <!-- EDAD MÍNIMA -->
                        <Border Grid.Column="1" x:Name="fondoPegi" Background="#FF1E1E1E" CornerRadius="5" Padding="5" ToolTip="PEGI" Margin="10,0,10,0"
                                VerticalAlignment="Center" Width="50" Height="50">
                            <TextBlock x:Name="edadMinimaText" Text="+0" FontSize="20" FontWeight="Bold" Foreground="White" TextAlignment="Center" VerticalAlignment="Center"/>
                        </Border>


                        <!-- PLATAFORMAS -->
                        <StackPanel Grid.Column="2" x:Name="plataformasPanel" Orientation="Horizontal" VerticalAlignment="Center" Margin="10,0,10,0"/>

                    </Grid>





                    <!--BOTON PARA BORRAR EL JUEGO DE STEAM-->
                    <Button x:Name="btnEliminar" Grid.Column="4" Content="Delete game" FontSize="16" Width="160" Height="36" HorizontalAlignment="Right"
                            Cursor="Hand" Margin="0,0,0,0" Style="{StaticResource DeleteButton}" VerticalAlignment="Center" Click="btnEliminar_Click"/>
                    
                    

                </Grid>
            </Border>


        </Grid>
        
        
        
        <!--PARTE PARA LA BIBLIOTECA DEL USUARIO-->
        <Border Grid.Row="1" CornerRadius="8" Background="#2A2A2A" Padding="8" Effect="{DynamicResource DropShadowEffect}" Margin="10">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <ItemsControl Name="panelJuegos" ItemsSource="{Binding Juegos}" HorizontalAlignment="Center">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>

                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Grid>
                                <Image Width="110" Height="165" Margin="8" Stretch="UniformToFill" MouseLeftButtonUp="Juego_Click"
                                       Source="{Binding Imagen}" Style="{DynamicResource GameImageStyle}" Visibility="{Binding Imagen, Converter={StaticResource NullToVisibilityConverter}}"/>
                                <TextBlock Text="{Binding NombreError}" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"
                                           FontSize="21" Margin="0,80,0,0" TextWrapping="Wrap" TextAlignment="Center"
                                           Visibility="{Binding NombreError, Converter={StaticResource NullToVisibilityConverter}}"/>
                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Border>






        <!-- OVERLAY DE CARGANDO CON BLUR REAL -->
        <Grid x:Name="LoadingOverlay" Visibility="Collapsed" Grid.RowSpan="2" Margin="0,0,0,0">

            <!-- Grid interno para aplicar blur -->
            <Grid>
                <Grid.Effect>
                    <BlurEffect Radius="25"/>
                    <!-- Ajusta para más o menos blur -->
                </Grid.Effect>

                <!-- Rectangle que copia visualmente el contenido del RootGrid -->
                <Rectangle>
                    <Rectangle.Fill>
                        <VisualBrush Visual="{Binding ElementName=RootGrid}" Stretch="None"/>
                    </Rectangle.Fill>
                    <Rectangle.CacheMode>
                        <BitmapCache/>
                    </Rectangle.CacheMode>
                </Rectangle>
            </Grid>

            <!-- Capa semi-transparente para oscurecer -->
            <Rectangle Fill="#44000000"/>

            <!-- Contenido del overlay -->
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <!-- CÍRCULO DE CARGA MODERNO -->
                <Grid Width="100" Height="100">
                    <!-- Círculo de fondo -->
                    <Ellipse Width="80" Height="80"
                             Stroke="#FFFFFF33"
                             StrokeThickness="10"
                             HorizontalAlignment="Center"
                             VerticalAlignment="Center"/>

                    <!-- Arco animado en un Viewbox -->
                    <Viewbox Stretch="Uniform" HorizontalAlignment="Center" VerticalAlignment="Center">
                        <Canvas Width="100" Height="100">
                            <Path Stroke="White" StrokeThickness="10"
                                  StrokeStartLineCap="Round" StrokeEndLineCap="Round">
                                <Path.Data>
                                    <PathGeometry>
                                        <PathFigure StartPoint="50,10">
                                            <ArcSegment x:Name="SpinnerArc"
                                        Point="50,90"
                                        Size="40,40"
                                        IsLargeArc="False"
                                        SweepDirection="Clockwise"/>
                                        </PathFigure>
                                    </PathGeometry>
                                </Path.Data>
                                <Path.RenderTransform>
                                    <RotateTransform x:Name="SpinnerRotate" CenterX="50" CenterY="50"/>
                                </Path.RenderTransform>
                            </Path>
                        </Canvas>
                    </Viewbox>
                </Grid>


                <!-- TEXTO DE CARGA -->
                <TextBlock Foreground="White" FontSize="16" HorizontalAlignment="Center" TextAlignment="Center"
                           Text="Loading library... &#10; 
This process may take several minutes depending on how many games you have in your library. &#10; 
Please be patient, take a break, look out the window, close your eyes, disconnect from this world for a few minutes..." />
            </StackPanel>

        </Grid>





    </Grid>
</Page>
